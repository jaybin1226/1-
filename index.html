<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ 1 10ì›” ëª¨ì˜ê³ ì‚¬ ì˜ì–´ ë‹¨ì–´ í…ŒìŠ¤íŠ¸</title>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<script src="https://cdn.tailwindcss.com"></script>
    
<style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+KR:wght@100..900&display=swap');
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            /* ë°°ê²½ìƒ‰ì„ í°ìƒ‰ ê³„ì—´ (ì•„ì£¼ ì—°í•œ íšŒìƒ‰)ìœ¼ë¡œ ë³€ê²½ */
            background-color: #f9fafb; 
        }
        /* ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
        @keyframes pulse-success {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse-success {
            animation: pulse-success 0.5s infinite;
        }
        
        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ì„ ìœ„í•œ Tailwind ìƒ‰ìƒ ë³€ìˆ˜ ì„¤ì • */
        .btn-primary {
            background-color: #0045f3; /* ìš”ì²­ëœ íŒŒë€ìƒ‰ */
        }
        .btn-primary:hover {
            background-color: #0037c2; /* ìš”ì²­ëœ íŒŒë€ìƒ‰ì˜ ì•½ê°„ ì–´ë‘ìš´ í˜¸ë²„ ìƒ‰ìƒ */
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6">

    
<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // =================================================================================
        // [ì‚¬ìš©ì ì„¤ì • ì˜ì—­] - ì´ ë³€ìˆ˜ ê°’ë§Œ ìˆ˜ì •í•˜ì—¬ ë¡œê³ ë¥¼ ë³€ê²½í•˜ì„¸ìš”.
        // ì—¬ê¸°ì— ë¡œê³  ì´ë¯¸ì§€ URL (http/httpsë¡œ ì‹œì‘) ë˜ëŠ” Base64 ì¸ì½”ë”©ëœ SVG ë°ì´í„°ë¥¼ ë„£ìœ¼ì„¸ìš”.
        // data:image/svg+xml;base64,... í˜•íƒœì˜ SVGë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        // =================================================================================
        const STATIC_LOGO_SOURCE = "https://i.ifh.cc/J5Gw80.png";
        const LOGO_FALLBACK_URL = "https://placehold.co/320x80/6b7280/ffffff?text=Default+Logo"; // ë¡œë”© ì‹¤íŒ¨ ì‹œ í‘œì‹œí•  ê¸°ë³¸ ë¡œê³ 
        // =================================================================================
        
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Global Firebase instances
        window.db = null;
        window.auth = null;
        window.userId = null;
        
        function updateLogoImage(url) {
            const logoImg = document.getElementById('app-logo');
            logoImg.src = url;
            logoImg.onerror = () => {
                // Fallback to default placeholder if the provided URL fails to load
                logoImg.src = LOGO_FALLBACK_URL;
                if (url !== LOGO_FALLBACK_URL) {
                     console.warn(`Failed to load custom logo from: ${url}. Using default placeholder.`);
                }
            };
        }

        if (Object.keys(firebaseConfig).length > 0) {
            try {
                const app = initializeApp(firebaseConfig);
                window.db = getFirestore(app);
                window.auth = getAuth(app);
                // setLogLevel('debug'); // Uncomment for debugging

                // Sign in using custom token or anonymously
                (async () => {
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(window.auth, initialAuthToken);
                        } else {
                            await signInAnonymously(window.auth);
                        }
                        window.userId = window.auth.currentUser?.uid || crypto.randomUUID();
                        document.getElementById('quiz-app').style.display = 'block';
                        
                        updateLogoImage(STATIC_LOGO_SOURCE); // **ì •ì  ë¡œê³  ì„¤ì •**

                    } catch (error) {
                        console.error("Firebase Auth failed:", error);
                        alertBox.show('ë¡œê·¸ì¸ ì‹¤íŒ¨: í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.');
                    }
                })();

            } catch (error) {
                console.error("Firebase Initialization failed:", error);
                alertBox.show('íŒŒì´ì–´ë² ì´ìŠ¤ ì´ˆê¸°í™” ì‹¤íŒ¨: í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        } else {
            console.warn("Firebase config not found. Running application without persistence/auth.");
            // Proceed without Firebase (fallback for local testing)
            window.userId = crypto.randomUUID();
            document.getElementById('quiz-app').style.display = 'block';
            updateLogoImage(STATIC_LOGO_SOURCE); // **ì •ì  ë¡œê³  ì„¤ì •**
        }
    </script>

    

<div id="quiz-app" class="w-full max-w-lg bg-white rounded-xl p-6 md:p-10 border border-gray-100 shadow-xl" style="display: none;">
        
        

<div id="logo-area" class="mb-8 p-0 flex justify-center">
            <img id="app-logo" 
                 src="" 
                 alt="ê³ 1 ëª¨ì˜ê³ ì‚¬ ì˜ì–´ ë‹¨ì–´ í…ŒìŠ¤íŠ¸ ë¡œê³ " 
                 class="h-20 w-auto max-w-xs rounded-lg object-contain">
        </div>

        
<div id="settings-area" class="space-y-4 mb-8 p-4 bg-blue-50 rounded-lg shadow-inner">
            
            

<div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0">
                
<div class="w-full sm:w-1/2">
                    <label for="quizMode" class="block text-base font-bold text-gray-700 mb-1">í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì„ íƒ</label>
                    <div class="flex bg-white rounded-xl p-1 border border-blue-300 shadow-lg">
                        

<button id="mode-subjective" data-mode="subjective" class="flex-1 py-3 px-4 text-base font-semibold rounded-lg transition-all duration-200 bg-blue-800 text-white shadow-md">
                            ì£¼ê´€ì‹ (ì˜â†’í•œ)
                        </button>
                        <button id="mode-multiple" data-mode="multiple" class="flex-1 py-3 px-4 text-base font-medium text-gray-600 rounded-lg transition-all duration-200 hover:bg-blue-100">
                            ê°ê´€ì‹ (í•œâ†’ì˜)
                        </button>
                    </div>
                </div>

                
<div class="w-full sm:w-1/2 sm:ml-4">
                    <label for="quizDifficulty" class="block text-base font-bold text-gray-700 mb-1">ë‚œì´ë„ ì„ íƒ</label>
                    <select id="quiz-difficulty" class="w-full mt-1 p-3 border-2 border-blue-300 rounded-xl shadow-inner focus:ring-blue-700 focus:border-blue-700 transition duration-150 ease-in-out text-base">
                        <option value="easy">ì‰¬ì›€</option>
                        <option value="normal" selected>ë³´í†µ</option>
                        <option value="hard">ì–´ë ¤ì›€</option>
                    </select>
                </div>
            </div>
            

<button id="start-quiz-btn" class="w-full py-4 text-lg btn-primary text-white font-bold rounded-xl transition duration-200 shadow-xl mt-4">
                í…ŒìŠ¤íŠ¸ ì‹œì‘
            </button>
        </div>

        
<div id="quiz-area" class="hidden">
            
<div class="flex justify-between items-center mb-4">
                <p id="question-counter" class="text-lg font-bold text-blue-900">1 / 20</p>
                

<button id="go-to-home-btn-quiz" class="py-2 px-4 text-sm btn-primary text-white font-medium rounded-lg transition duration-200 shadow-md">
                    Home
                </button>
            </div>

            
<div class="bg-white border border-gray-200 rounded-xl p-6 shadow-lg">
                <p id="question-text" class="text-2xl md:text-3xl font-bold text-center text-gray-800 min-h-20 flex items-center justify-center">
                    
</p>
            </div>

            <div class="mt-6">
                
<div id="subjective-input" class="hidden">
                    <label for="answer-input" class="block text-sm font-medium text-gray-700 mb-2">ì •ë‹µ ì…ë ¥ (í•œê¸€ ëœ»)</label>
                    <input type="text" id="answer-input" class="w-full p-3 border-2 border-blue-300 rounded-lg focus:ring-blue-700 focus:border-blue-700 transition duration-150" placeholder="ì—¬ê¸°ì— ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
                    
                    <div class="flex space-x-3 mt-4">
                        

<button id="submit-btn-subjective" class="flex-1 py-3 btn-primary text-white font-bold rounded-lg transition duration-200 shadow-md">
                            ì œì¶œí•˜ê¸°
                        </button>
                        <button id="pass-btn-subjective" class="flex-1 py-3 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600 transition duration-200 shadow-md">
                            PASS
                        </button>
                    </div>
                </div>

                
<div id="multiple-choice-options" class="hidden space-y-3">
                    
</div>
                
                
<button id="pass-btn-multiple" class="w-full mt-4 py-3 bg-gray-500 text-white font-bold rounded-lg hover:bg-gray-600 transition duration-200 shadow-md hidden">
                    PASS
</button>
            </div>

            
<div id="feedback-area" class="mt-6 p-4 rounded-lg hidden transition duration-300">
                <p id="feedback-message" class="font-bold text-lg"></p>
                <p id="correct-answer-display" class="mt-2 text-base"></p>
                
                

<button id="next-question-btn" class="w-full mt-4 py-3 btn-primary text-white font-bold rounded-lg transition duration-200 shadow-md">
                    ë‹¤ìŒ ë¬¸ì œë¡œ
                </button>
            </div>
        </div>

        
<div id="result-area" class="hidden text-center p-6 bg-white rounded-xl shadow-lg border-2 border-blue-300">
            <h2 class="text-3xl font-extrabold text-blue-800 mb-4">í…ŒìŠ¤íŠ¸ ì¢…ë£Œ!</h2>
            <p class="text-xl text-gray-700 mb-6">ìµœì¢… ì ìˆ˜: <span id="final-score" class="font-bold text-4xl text-blue-600"></span> / 20</p>

            <div id="failed-words-summary" class="bg-red-50 p-4 rounded-lg mb-6 hidden">
                <p class="font-bold text-red-700 mb-2">í‹€ë¦° ë‹¨ì–´ ëª©ë¡</p>
                <ul id="failed-words-list" class="text-sm text-gray-700 space-y-1 text-left">
                    
</ul>
            </div>

            <button id="restart-failed-btn" class="w-full py-3 bg-red-700 text-white font-bold rounded-lg hover:bg-red-800 transition duration-200 shadow-md mb-3 hidden">
                í‹€ë¦° ë‹¨ì–´ë§Œ ë‹¤ì‹œ í’€ê¸°
            </button>
            

<button id="go-to-settings-btn" class="w-full py-3 btn-primary text-white font-bold rounded-lg transition duration-200 shadow-md">
                Home
            </button>
        </div>
    </div>

    
<div id="alert-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
            <h3 class="text-xl font-bold text-gray-800 mb-3" id="alert-title">ì•Œë¦¼</h3>
            <p class="text-gray-600 mb-6" id="alert-message"></p>
            

<button id="alert-ok-btn" class="w-full py-2 btn-primary text-white font-bold rounded-lg">í™•ì¸</button>
        </div>
    </div>

    <script>
        // Custom Alert/Confirmation Box Logic
        const alertBox = {
            overlay: document.getElementById('alert-overlay'),
            title: document.getElementById('alert-title'),
            message: document.getElementById('alert-message'),
            okBtn: document.getElementById('alert-ok-btn'),

            show: function(msg, title = 'ì•Œë¦¼') {
                this.title.textContent = title;
                this.message.textContent = msg;
                this.overlay.classList.remove('hidden');
                this.overlay.classList.add('flex');
                this.okBtn.onclick = () => this.hide();
            },
            hide: function() {
                this.overlay.classList.add('hidden');
                this.overlay.classList.remove('flex');
            }
        };


        // 1. Vocabulary Data (Extracted from 2024 High School 1st Grade October Mock Exam Passages + extensive additions)
        // ** Total 150 words ** (50 for each difficulty level)
        const vocabulary = [
            // =================================================================================================
            // EASY WORDS (ì´ 50ê°œ - ê¸°ë³¸ ë‹¨ì–´ ë° í•µì‹¬ ë™ì‚¬/ëª…ì‚¬ ìœ„ì£¼)
            // =================================================================================================
            { english: "legal", korean: ["ë²•ì ì¸", "í•©ë²•ì ì¸"], difficulty: "easy" },
            { english: "room", korean: ["ì—¬ì§€", "ê³µê°„", "ë°©"], difficulty: "easy" },
            { english: "packed", korean: ["ë¹½ë¹½í•œ", "ê½‰ ë“¤ì–´ì°¬"], difficulty: "easy" },
            { english: "ensure", korean: ["ë³´ì¥í•˜ë‹¤", "í™•ì‹¤í•˜ê²Œ í•˜ë‹¤"], difficulty: "easy" },
            { english: "immediate", korean: ["ì¦‰ê°ì ì¸", "ë‹¹ë©´í•œ"], difficulty: "easy" },
            { english: "therapy", korean: ["ì¹˜ë£Œ", "ìš”ë²•"], difficulty: "easy" },
            { english: "compare", korean: ["ë¹„êµí•˜ë‹¤", "ê²¬ì£¼ë‹¤"], difficulty: "easy" },
            { english: "stare", korean: ["ì‘ì‹œí•˜ë‹¤", "ëš«ì–´ì§€ê²Œ ë³´ë‹¤"], difficulty: "easy" },
            { english: "clearly", korean: ["ë¶„ëª…íˆ", "ëª…í™•í•˜ê²Œ"], difficulty: "easy" },
            { english: "isolated", korean: ["ê³ ë¦½ëœ", "ê²©ë¦¬ëœ"], difficulty: "easy" },
            { english: "scold", korean: ["ê¾¸ì§–ë‹¤", "ì•¼ë‹¨ì¹˜ë‹¤"], difficulty: "easy" },
            { english: "cheerful", korean: ["ëª…ë‘í•œ", "ì¾Œí™œí•œ"], difficulty: "easy" },
            { english: "public", korean: ["ê³µê³µì˜", "ëŒ€ì¤‘ì˜"], difficulty: "easy" },
            { english: "private", korean: ["ê°œì¸ì˜", "ì‚¬ì ì¸"], difficulty: "easy" },
            { english: "limit", korean: ["ì œí•œí•˜ë‹¤", "í•œê³„"], difficulty: "easy" },
            { english: "focus", korean: ["ì´ˆì ", "ì§‘ì¤‘í•˜ë‹¤"], difficulty: "easy" },
            { english: "mention", korean: ["ì–¸ê¸‰í•˜ë‹¤", "ë§í•˜ë‹¤"], difficulty: "easy" },
            { english: "habit", korean: ["ìŠµê´€", "ë²„ë¦‡"], difficulty: "easy" },
            { english: "value", korean: ["ê°€ì¹˜", "í‰ê°€í•˜ë‹¤"], difficulty: "easy" },
            { english: "view", korean: ["ê´€ì ", "ì‹œì•¼", "ë³´ë‹¤"], difficulty: "easy" },
            { english: "create", korean: ["ë§Œë“¤ë‹¤", "ì°½ì¡°í•˜ë‹¤"], difficulty: "easy" },
            { english: "solve", korean: ["í•´ê²°í•˜ë‹¤", "í’€ë‹¤"], difficulty: "easy" },
            { english: "exist", korean: ["ì¡´ì¬í•˜ë‹¤", "ì‹¤ì¬í•˜ë‹¤"], difficulty: "easy" },
            { english: "nature", korean: ["ìì—°", "ë³¸ì§ˆ", "ì„±ì§ˆ"], difficulty: "easy" },
            { english: "affect", korean: ["ì˜í–¥ì„ ë¯¸ì¹˜ë‹¤", "ê°ë™ì‹œí‚¤ë‹¤"], difficulty: "easy" },
            { english: "source", korean: ["ê·¼ì›", "ì›ì²œ"], difficulty: "easy" },
            { english: "define", korean: ["ì •ì˜í•˜ë‹¤", "ê·œì •í•˜ë‹¤"], difficulty: "easy" },
            { english: "provide", korean: ["ì œê³µí•˜ë‹¤", "ì£¼ë‹¤"], difficulty: "easy" },
            { english: "appear", korean: ["ë‚˜íƒ€ë‚˜ë‹¤", "ì²˜ëŸ¼ ë³´ì´ë‹¤"], difficulty: "easy" },
            { english: "matter", korean: ["ë¬¸ì œ", "ì¤‘ìš”í•˜ë‹¤", "ë¬¼ì§ˆ"], difficulty: "easy" },
            { english: "depend", korean: ["ì˜ì¡´í•˜ë‹¤", "ë‹¬ë ¤ìˆë‹¤"], difficulty: "easy" },
            { english: "recognize", korean: ["ì¸ì‹í•˜ë‹¤", "ì•Œì•„ë³´ë‹¤"], difficulty: "easy" },
            { english: "sense", korean: ["ê°ê°", "ì˜ë¯¸", "ëŠë¼ë‹¤"], difficulty: "easy" },
            { english: "share", korean: ["ê³µìœ í•˜ë‹¤", "ëª«"], difficulty: "easy" },
            { english: "spread", korean: ["í¼ì§€ë‹¤", "í™•ì‚°ì‹œí‚¤ë‹¤"], difficulty: "easy" },
            { english: "purpose", korean: ["ëª©ì ", "ì˜ë„"], difficulty: "easy" },
            { english: "develop", korean: ["ë°œì „ì‹œí‚¤ë‹¤", "ê°œë°œí•˜ë‹¤"], difficulty: "easy" },
            { english: "determine", korean: ["ê²°ì •í•˜ë‹¤", "ë°í˜€ë‚´ë‹¤"], difficulty: "easy" },
            { english: "prevent", korean: ["ë§‰ë‹¤", "ì˜ˆë°©í•˜ë‹¤"], difficulty: "easy" },
            { english: "region", korean: ["ì§€ì—­", "ì˜ì—­"], difficulty: "easy" },
            { english: "require", korean: ["ìš”êµ¬í•˜ë‹¤", "í•„ìš”ë¡œ í•˜ë‹¤"], difficulty: "easy" },
            { english: "support", korean: ["ì§€ì§€í•˜ë‹¤", "í›„ì›í•˜ë‹¤"], difficulty: "easy" },
            { english: "suggest", korean: ["ì œì•ˆí•˜ë‹¤", "ì•”ì‹œí•˜ë‹¤"], difficulty: "easy" },
            { english: "treat", korean: ["ë‹¤ë£¨ë‹¤", "ì¹˜ë£Œí•˜ë‹¤", "ëŒ€ì ‘í•˜ë‹¤"], difficulty: "easy" },
            { english: "observe", korean: ["ê´€ì°°í•˜ë‹¤", "ì¤€ìˆ˜í•˜ë‹¤"], difficulty: "easy" },
            { english: "distinguish", korean: ["êµ¬ë³„í•˜ë‹¤", "ì‹ë³„í•˜ë‹¤"], difficulty: "easy" },
            { english: "evidence", korean: ["ì¦ê±°", "í”ì "], difficulty: "easy" },
            { english: "involve", korean: ["ìˆ˜ë°˜í•˜ë‹¤", "ê´€ë ¨ì‹œí‚¤ë‹¤"], difficulty: "easy" },
            { english: "approach", korean: ["ì ‘ê·¼í•˜ë‹¤", "ì ‘ê·¼ë²•"], difficulty: "easy" },
            { english: "conclude", korean: ["ê²°ë¡ ì§“ë‹¤", "ëë‚´ë‹¤"], difficulty: "easy" },

            // =================================================================================================
            // NORMAL WORDS (ì´ 50ê°œ - í•µì‹¬ ë‹¨ì–´, ë¹ˆì¶œ í˜•ìš©ì‚¬/ë¶€ì‚¬/ì¶”ìƒëª…ì‚¬ ìœ„ì£¼)
            // =================================================================================================
            { english: "commitment", korean: ["ì „ë…", "í—Œì‹ ", "ì•½ì†"], difficulty: "normal" },
            { english: "obligation", korean: ["ì˜ë¬´", "ì±…ì„"], difficulty: "normal" },
            { english: "eyewitness", korean: ["ëª©ê²©ì"], difficulty: "normal" },
            { english: "consistency", korean: ["ì¼ê´€ì„±", "ì§€ì†ì„±"], difficulty: "normal" },
            { english: "distribute", korean: ["ë¶„ë°°í•˜ë‹¤", "ë‚˜ëˆ„ì–´ ì£¼ë‹¤"], difficulty: "normal" },
            { english: "passive", korean: ["ìˆ˜ë™ì ì¸", "ì†Œê·¹ì ì¸"], difficulty: "normal" },
            { english: "transformation", korean: ["ë³€í™”", "ë³€ì‹ "], difficulty: "normal" },
            { english: "impact", korean: ["íš¨ê³¼", "ì˜í–¥", "ì¶©ê²©"], difficulty: "normal" },
            { english: "highlight", korean: ["ê°•ì¡°í•˜ë‹¤", "ë¶€ê°ì‹œí‚¤ë‹¤"], difficulty: "normal" },
            { english: "pretend", korean: ["~ì¸ ì²´í•˜ë‹¤", "ê°€ì¥í•˜ë‹¤"], difficulty: "normal" },
            { english: "indifference", korean: ["ë¬´ê´€ì‹¬", "ëƒ‰ë‹´"], difficulty: "normal" },
            { english: "pride", korean: ["ìì¡´ì‹¬", "ê¸ì§€", "ìë¶€ì‹¬"], difficulty: "normal" },
            { english: "authority", korean: ["ê¶Œí•œ", "ë‹¹êµ­", "ê¶Œìœ„"], difficulty: "normal" },
            { english: "potential", korean: ["ì ì¬ë ¥", "ê°€ëŠ¥ì„±"], difficulty: "normal" },
            { english: "strategy", korean: ["ì „ëµ", "ê³„íš"], difficulty: "normal" },
            { english: "perspective", korean: ["ê´€ì ", "ì‹œê°"], difficulty: "normal" },
            { english: "interpret", korean: ["í•´ì„í•˜ë‹¤", "ì´í•´í•˜ë‹¤"], difficulty: "normal" },
            { english: "essential", korean: ["í•„ìˆ˜ì ì¸", "ë³¸ì§ˆì ì¸"], difficulty: "normal" },
            { english: "crucial", korean: ["ê²°ì •ì ì¸", "ë§¤ìš° ì¤‘ìš”í•œ"], difficulty: "normal" },
            { english: "acquire", korean: ["ìŠµë“í•˜ë‹¤", "ì–»ë‹¤"], difficulty: "normal" },
            { english: "relevant", korean: ["ê´€ë ¨ëœ", "ì ì ˆí•œ"], difficulty: "normal" },
            { english: "process", korean: ["ê³¼ì •", "ì ˆì°¨"], difficulty: "normal" },
            { english: "establish", korean: ["ì„¤ë¦½í•˜ë‹¤", "í™•ë¦½í•˜ë‹¤"], difficulty: "normal" },
            { english: "function", korean: ["ê¸°ëŠ¥", "ì‘ë™í•˜ë‹¤"], difficulty: "normal" },
            { english: "structure", korean: ["êµ¬ì¡°", "êµ¬ì„±"], difficulty: "normal" },
            { english: "consequence", korean: ["ê²°ê³¼", "ì¤‘ìš”ì„±"], difficulty: "normal" },
            { english: "temporary", korean: ["ì¼ì‹œì ì¸", "ì„ì‹œì˜"], difficulty: "normal" },
            { english: "alternative", korean: ["ëŒ€ì•ˆ", "ì–‘ìíƒì¼ì˜"], difficulty: "normal" },
            { english: "capacity", korean: ["ëŠ¥ë ¥", "ìˆ˜ìš©ë ¥"], difficulty: "normal" },
            { english: "concept", korean: ["ê°œë…", "ì‚¬ìƒ"], difficulty: "normal" },
            { english: "dimension", korean: ["ì°¨ì›", "ì¸¡ë©´"], difficulty: "normal" },
            { english: "diverse", korean: ["ë‹¤ì–‘í•œ", "ê°€ì§€ê°ìƒ‰ì˜"], difficulty: "normal" },
            { english: "generate", korean: ["ë§Œë“¤ì–´ë‚´ë‹¤", "ë°œìƒì‹œí‚¤ë‹¤"], difficulty: "normal" },
            { english: "interaction", korean: ["ìƒí˜¸ ì‘ìš©", "êµë¥˜"], difficulty: "normal" },
            { english: "justify", korean: ["ì •ë‹¹í™”í•˜ë‹¤", "ì˜³ìŒì„ ì¦ëª…í•˜ë‹¤"], difficulty: "normal" },
            { english: "mutual", korean: ["ìƒí˜¸ì ì¸", "ê³µë™ì˜"], difficulty: "normal" },
            { english: "perception", korean: ["ì¸ì‹", "ì§€ê°"], difficulty: "normal" },
            { english: "preference", korean: ["ì„ í˜¸", "ì• í˜¸"], difficulty: "normal" },
            { english: "prioritize", korean: ["ìš°ì„ ìˆœìœ„ë¥¼ ë§¤ê¸°ë‹¤"], difficulty: "normal" },
            { english: "resilient", korean: ["íšŒë³µë ¥ ìˆëŠ”", "íƒ„ë ¥ ìˆëŠ”"], difficulty: "normal" },
            { english: "restrict", korean: ["ì œí•œí•˜ë‹¤", "í•œì •í•˜ë‹¤"], difficulty: "normal" },
            { english: "significance", korean: ["ì¤‘ìš”ì„±", "ì˜ë¯¸"], difficulty: "normal" },
            { english: "specific", korean: ["íŠ¹ì •í•œ", "êµ¬ì²´ì ì¸"], difficulty: "normal" },
            { english: "subtle", korean: ["ë¯¸ë¬˜í•œ", "í¬ì°©í•˜ê¸° ì–´ë ¤ìš´"], difficulty: "normal" },
            { english: "tendency", korean: ["ê²½í–¥", "ì„±í–¥"], difficulty: "normal" },
            { english: "withdraw", korean: ["ì² íšŒí•˜ë‹¤", "ì¸ì¶œí•˜ë‹¤"], difficulty: "normal" },
            { english: "utilize", korean: ["í™œìš©í•˜ë‹¤", "ì´ìš©í•˜ë‹¤"], difficulty: "normal" },
            { english: "conduct", korean: ["ìˆ˜í–‰í•˜ë‹¤", "ì‹¤ì‹œí•˜ë‹¤", "í–‰ë™"], difficulty: "normal" },
            { english: "exposure", korean: ["ë…¸ì¶œ", "ì ‘ì´‰"], difficulty: "normal" },
            { english: "mechanism", korean: ["ë©”ì»¤ë‹ˆì¦˜", "ê¸°êµ¬"], difficulty: "normal" },

            // =================================================================================================
            // HARD WORDS (ì´ 50ê°œ - ê³ ë‚œë„, ì§€ë¬¸ ë…í•´ì— í•„ìˆ˜ì ì¸ ë‹¨ì–´ ìœ„ì£¼)
            // =================================================================================================
            { english: "undermine", korean: ["í›¼ì†ì‹œí‚¤ë‹¤", "ì•½í™”ì‹œí‚¤ë‹¤"], difficulty: "hard" },
            { english: "retrieve", korean: ["ìƒê¸°í•˜ë‹¤", "ë˜ì°¾ë‹¤", "ê²€ìƒ‰í•˜ë‹¤"], difficulty: "hard" },
            { english: "procrastinator", korean: ["ë¯¸ë£¨ëŠ” ì‚¬ëŒ", "ì§€ì—°í•˜ëŠ” ì‚¬ëŒ"], difficulty: "hard" },
            { english: "endurance", korean: ["ì¸ë‚´ë ¥", "ì§€êµ¬ë ¥"], difficulty: "hard" },
            { english: "transmit", korean: ["ì „ë‹¬í•˜ë‹¤", "ì „ì†¡í•˜ë‹¤"], difficulty: "hard" },
            { english: "illusion", korean: ["ì°©ê°", "ì˜¤í•´", "í™˜ìƒ"], difficulty: "hard" },
            { english: "spectacle", korean: ["ì¥ê´€", "êµ¬ê²½ê±°ë¦¬"], difficulty: "hard" },
            { english: "mimic", korean: ["ëª¨ë°©í•˜ë‹¤", "í‰ë‚´ ë‚´ë‹¤"], difficulty: "hard" },
            { english: "eliminate", korean: ["ì œê±°í•˜ë‹¤", "ì—†ì• ë‹¤"], difficulty: "hard" },
            { english: "scarcity", korean: ["ë¶€ì¡±", "í¬ì†Œì„±"], difficulty: "hard" },
            { english: "inequity", korean: ["ë¶ˆí‰ë“±", "ë¶ˆê³µí‰"], difficulty: "hard" },
            { english: "evolutionary", korean: ["ì§„í™”ìƒì˜", "ì§„í™”ì ì¸"], difficulty: "hard" },
            { english: "manipulate", korean: ["ì¡°ì¢…í•˜ë‹¤", "ë‹¤ë£¨ë‹¤"], difficulty: "hard" },
            { english: "exaggerate", korean: ["ê³¼ì¥í•˜ë‹¤", "ì§€ë‚˜ì¹˜ê²Œ ë§í•˜ë‹¤"], difficulty: "hard" },
            { english: "sustain", korean: ["ì§€ì†í•˜ë‹¤", "ìœ ì§€í•˜ë‹¤"], difficulty: "hard" },
            { english: "paradigm", korean: ["íŒ¨ëŸ¬ë‹¤ì„", "ëª¨ë²”", "ì‚¬ê³ ì˜ í‹€"], difficulty: "hard" },
            { english: "implicit", korean: ["ì•”ë¬µì ì¸", "ë‚´í¬ëœ"], difficulty: "hard" },
            { english: "explicit", korean: ["ëª…ì‹œì ì¸", "ë…¸ê³¨ì ì¸"], difficulty: "hard" },
            { english: "bias", korean: ["í¸ê²¬", "ì„ ì…ê²¬"], difficulty: "hard" },
            { english: "decline", korean: ["ì‡ í‡´", "ê±°ì ˆí•˜ë‹¤"], difficulty: "hard" },
            { english: "conventional", korean: ["ì „í†µì ì¸", "ê´€ìŠµì ì¸"], difficulty: "hard" },
            { english: "sophisticated", korean: ["ì •êµí•œ", "ì„¸ë ¨ëœ"], difficulty: "hard" },
            { english: "vulnerable", korean: ["ì·¨ì•½í•œ", "ìƒì²˜ë°›ê¸° ì‰¬ìš´"], difficulty: "hard" },
            { english: "interact", korean: ["ìƒí˜¸ì‘ìš©í•˜ë‹¤", "ì†Œí†µí•˜ë‹¤"], difficulty: "hard" },
            { english: "consensus", korean: ["ì˜ê²¬ ì¼ì¹˜", "í•©ì˜"], difficulty: "hard" },
            { english: "ultimate", korean: ["ê¶ê·¹ì ì¸", "ìµœì¢…ì ì¸"], difficulty: "hard" },
            { english: "prejudice", korean: ["í¸ê²¬", "ì„ ì…ê´€"], difficulty: "hard" },
            { english: "compel", korean: ["ê°•ìš”í•˜ë‹¤", "ì–µì§€ë¡œ ì‹œí‚¤ë‹¤"], difficulty: "hard" },
            { english: "commence", korean: ["ì‹œì‘í•˜ë‹¤", "ì°©ìˆ˜í•˜ë‹¤"], difficulty: "hard" },
            { english: "diligent", korean: ["ë¶€ì§€ëŸ°í•œ", "ì„±ì‹¤í•œ"], difficulty: "hard" },
            { english: "expedite", korean: ["ì´‰ì§„í•˜ë‹¤", "ì‹ ì†íˆ ì²˜ë¦¬í•˜ë‹¤"], difficulty: "hard" },
            { english: "fluctuate", korean: ["ë³€ë™í•˜ë‹¤", "ì˜¤ë¥´ë‚´ë¦¬ë‹¤"], difficulty: "hard" },
            { english: "hinder", korean: ["ë°©í•´í•˜ë‹¤", "ì €í•´í•˜ë‹¤"], difficulty: "hard" },
            { english: "inevitable", korean: ["í”¼í•  ìˆ˜ ì—†ëŠ”", "í•„ì—°ì ì¸"], difficulty: "hard" },
            { english: "integrate", korean: ["í†µí•©í•˜ë‹¤", "í•©ì¹˜ë‹¤"], difficulty: "hard" },
            { english: "legacy", korean: ["ìœ ì‚°", "ì”ì¬"], difficulty: "hard" },
            { english: "mediate", korean: ["ì¤‘ì¬í•˜ë‹¤", "ì¡°ì •í•˜ë‹¤"], difficulty: "hard" },
            { english: "novice", korean: ["ì´ˆì‹¬ì", "í’‹ë‚´ê¸°"], difficulty: "hard" },
            { english: "obsolete", korean: ["ì‹œëŒ€ì— ë’¤ë–¨ì–´ì§„", "êµ¬ì‹ì˜"], difficulty: "hard" },
            { english: "precede", korean: ["ì„ í–‰í•˜ë‹¤", "ì•ì„œë‹¤"], difficulty: "hard" },
            { english: "profound", korean: ["ì‹¬ì˜¤í•œ", "ê¹Šì€"], difficulty: "hard" },
            { english: "redundant", korean: ["ì¥í™©í•œ", "ë¶ˆí•„ìš”í•œ"], difficulty: "hard" },
            { english: "reinforce", korean: ["ê°•í™”í•˜ë‹¤", "ë³´ê°•í•˜ë‹¤"], difficulty: "hard" },
            { english: "speculate", korean: ["ì¶”ì¸¡í•˜ë‹¤", "íˆ¬ê¸°í•˜ë‹¤"], difficulty: "hard" },
            { english: "stimulate", korean: ["ìê·¹í•˜ë‹¤", "ê³ ë¬´í•˜ë‹¤"], difficulty: "hard" },
            { english: "transient", korean: ["ì¼ì‹œì ì¸", "ë§ì—†ëŠ”"], difficulty: "hard" },
            { english: "unprecedented", korean: ["ì „ë¡€ ì—†ëŠ”", "ìœ ë¡€ì—†ëŠ”"], difficulty: "hard" },
            { english: "validate", korean: ["ì…ì¦í•˜ë‹¤", "ì •ë‹¹ì„±ì„ í™•ì¸í•˜ë‹¤"], difficulty: "hard" },
            { english: "versatile", korean: ["ë‹¤ì¬ë‹¤ëŠ¥í•œ", "ë‹¤ìš©ë„ì˜"], difficulty: "hard" },
            { english: "widespread", korean: ["ë„ë¦¬ í¼ì§„", "ê´‘ë²”ìœ„í•œ"], difficulty: "hard"}
        ];

        // 2. Global State Variables
        let currentQuizList = [];
        let failedWords = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let currentMode = 'subjective'; // 'subjective' or 'multiple'
        let currentDifficulty = 'normal'; // 'easy', 'normal', or 'hard'
        const TOTAL_QUESTIONS = 20;

        // 3. DOM Elements
        const settingsArea = document.getElementById('settings-area');
        const quizArea = document.getElementById('quiz-area');
        const resultArea = document.getElementById('result-area');

        const modeSubjectiveBtn = document.getElementById('mode-subjective');
        const modeMultipleBtn = document.getElementById('mode-multiple');
        const difficultySelect = document.getElementById('quiz-difficulty');
        const startQuizBtn = document.getElementById('start-quiz-btn');

        const goToHomeBtnQuiz = document.getElementById('go-to-home-btn-quiz'); // í€´ì¦ˆ ì¤‘ í™ˆ ë²„íŠ¼
        
        const questionCounter = document.getElementById('question-counter');
        const questionText = document.getElementById('question-text');
        const questionCard = questionText.closest('.bg-white'); // Get the question card container for manipulation

        const subjectiveInputArea = document.getElementById('subjective-input');
        const answerInput = document.getElementById('answer-input');
        const submitBtnSubjective = document.getElementById('submit-btn-subjective');
        const passBtnSubjective = document.getElementById('pass-btn-subjective');

        const multipleChoiceOptions = document.getElementById('multiple-choice-options');
        const passBtnMultiple = document.getElementById('pass-btn-multiple');

        const feedbackArea = document.getElementById('feedback-area');
        const feedbackMessage = document.getElementById('feedback-message');
        const correctAnswerDisplay = document.getElementById('correct-answer-display');
        const nextQuestionBtn = document.getElementById('next-question-btn');

        const finalScoreDisplay = document.getElementById('final-score');
        const failedWordsList = document.getElementById('failed-words-list');
        const failedWordsSummary = document.getElementById('failed-words-summary');
        const restartFailedBtn = document.getElementById('restart-failed-btn');
        const goToSettingsBtn = document.getElementById('go-to-settings-btn');
        
        // --- Event Listeners Initialization ---
        
        // Settings events
        modeSubjectiveBtn.addEventListener('click', () => setMode('subjective'));
        modeMultipleBtn.addEventListener('click', () => setMode('multiple'));
        startQuizBtn.addEventListener('click', startQuiz);
        difficultySelect.addEventListener('change', (e) => currentDifficulty = e.target.value);
        
        // Quiz events
        submitBtnSubjective.addEventListener('click', () => checkAnswer(answerInput.value));
        passBtnSubjective.addEventListener('click', () => checkAnswer(null));
        passBtnMultiple.addEventListener('click', () => checkAnswer(null));
        nextQuestionBtn.addEventListener('click', nextQuestion);
        goToHomeBtnQuiz.addEventListener('click', goToSettings);
        
        // Result events
        restartFailedBtn.addEventListener('click', restartFailedQuiz);
        goToSettingsBtn.addEventListener('click', goToSettings);

        // Input field for subjective mode (allows Enter key submission)
        answerInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !submitBtnSubjective.disabled) {
                checkAnswer(this.value);
            }
        });
        
        // --- Core Functions ---

        function setMode(mode) {
            currentMode = mode;
            // Mode buttons use bg-blue-800 for selected and hover:bg-blue-100 for unselected.
            // Note: I will keep the mode buttons color scheme as it provides a good contrast (dark blue).
            // Only primary action buttons use .btn-primary.
            modeSubjectiveBtn.classList.remove('bg-blue-800', 'text-white', 'font-semibold');
            modeSubjectiveBtn.classList.add('text-gray-600', 'font-medium', 'hover:bg-blue-100');
            modeMultipleBtn.classList.remove('bg-blue-800', 'text-white', 'font-semibold');
            modeMultipleBtn.classList.add('text-gray-600', 'font-medium', 'hover:bg-blue-100');

            if (mode === 'subjective') {
                modeSubjectiveBtn.classList.add('bg-blue-800', 'text-white', 'font-semibold');
                modeSubjectiveBtn.classList.remove('text-gray-600', 'font-medium', 'hover:bg-blue-100');
            } else {
                modeMultipleBtn.classList.add('bg-blue-800', 'text-white', 'font-semibold');
                modeMultipleBtn.classList.remove('text-gray-600', 'font-medium', 'hover:bg-blue-100');
            }
        }
        
        function getShuffledQuizList(difficulty, count) {
            const filteredWords = vocabulary.filter(word => word.difficulty === difficulty);
            
            // Fisher-Yates shuffle algorithm
            for (let i = filteredWords.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [filteredWords[i], filteredWords[j]] = [filteredWords[j], filteredWords[i]];
            }
            
            return filteredWords.slice(0, count);
        }
        
        function startQuiz() {
            currentQuizList = getShuffledQuizList(currentDifficulty, TOTAL_QUESTIONS);
            if (currentQuizList.length === 0) {
                alertBox.show('ì„ íƒí•œ ë‚œì´ë„ì˜ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤. (ê°œë°œ ì˜¤ë¥˜)', 'ì˜¤ë¥˜');
                return;
            }
            
            failedWords = [];
            currentQuestionIndex = 0;
            score = 0;
            
            // UI Transition
            settingsArea.classList.add('hidden');
            resultArea.classList.add('hidden');
            quizArea.classList.remove('hidden');
            
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuizList.length) {
                showResult();
                return;
            }

            const word = currentQuizList[currentQuestionIndex];
            
            // UI Reset
            feedbackArea.classList.add('hidden');
            questionCard.classList.remove('border-red-500', 'border-green-500', 'animate-pulse-success');
            
            questionCounter.textContent = `${currentQuestionIndex + 1} / ${currentQuizList.length}`;
            
            if (currentMode === 'subjective') {
                // English to Korean (Subjective)
                questionText.textContent = word.english;
                subjectiveInputArea.classList.remove('hidden');
                multipleChoiceOptions.classList.add('hidden');
                passBtnMultiple.classList.add('hidden');
                
                answerInput.value = '';
                answerInput.focus();
                submitBtnSubjective.disabled = false;
                passBtnSubjective.disabled = false;
                
            } else {
                // Korean to English (Multiple Choice)
                const correctKoreanMeaning = word.korean[0]; // Use first meaning for the question
                questionText.textContent = correctKoreanMeaning;
                
                subjectiveInputArea.classList.add('hidden');
                multipleChoiceOptions.classList.remove('hidden');
                passBtnMultiple.classList.remove('hidden');
                
                generateMultipleChoice(word);
            }
        }

        function generateMultipleChoice(correctWord) {
            multipleChoiceOptions.innerHTML = '';
            
            const allEnglishWords = vocabulary.filter(w => w.difficulty === currentDifficulty).map(w => w.english);
            
            // Get 3 random unique incorrect options
            let incorrectOptions = [];
            while (incorrectOptions.length < 3) {
                const randomIndex = Math.floor(Math.random() * allEnglishWords.length);
                const randomWord = allEnglishWords[randomIndex];
                if (randomWord !== correctWord.english && !incorrectOptions.includes(randomWord)) {
                    incorrectOptions.push(randomWord);
                }
            }

            const options = [...incorrectOptions, correctWord.english];
            
            // Shuffle options
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            options.forEach((optionText) => {
                const button = document.createElement('button');
                button.textContent = optionText;
                button.classList.add(
                    'w-full', 'py-3', 'px-4', 'border', 'border-gray-300', 'rounded-lg', 
                    'text-lg', 'font-medium', 'text-gray-700', 'bg-white', 
                    'hover:bg-blue-50', 'transition', 'duration-150', 'shadow-md',
                    'text-left' // ì™¼ìª½ ì •ë ¬
                );
                button.dataset.answer = optionText;
                button.onclick = () => checkAnswer(optionText, button);
                multipleChoiceOptions.appendChild(button);
            });
            
            // Enable Pass Button
            passBtnMultiple.disabled = false;
        }

        function normalizeAnswer(answer) {
            if (!answer) return '';
            // Trim whitespace, convert to lowercase, remove common punctuation
            return answer.trim().toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").replace(/\s{2,}/g," ");
        }

        function checkAnswer(userAnswer, buttonElement = null) {
            const word = currentQuizList[currentQuestionIndex];
            let isCorrect = false;

            if (userAnswer !== null) {
                const normalizedUserAnswer = normalizeAnswer(userAnswer);
                
                if (currentMode === 'subjective') {
                    // Subjective check: check against all possible Korean meanings
                    isCorrect = word.korean.some(correctAns => normalizeAnswer(correctAns) === normalizedUserAnswer);
                } else {
                    // Multiple Choice check
                    isCorrect = (userAnswer === word.english);
                }
            } else {
                // PASS case
                isCorrect = false;
            }

            // Disable all interactive elements
            submitBtnSubjective.disabled = true;
            passBtnSubjective.disabled = true;
            passBtnMultiple.disabled = true;
            disableMultipleChoiceButtons();
            
            // UI Feedback
            if (isCorrect) {
                score++;
                feedbackMessage.textContent = 'ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰';
                feedbackMessage.classList.remove('text-red-700');
                feedbackMessage.classList.add('text-green-700');
                feedbackArea.classList.remove('bg-red-100');
                feedbackArea.classList.add('bg-green-100');
                questionCard.classList.add('border-green-500', 'animate-pulse-success');

            } else {
                // [FIX] ì˜¤ë‹µì„ ì œì¶œí•˜ê±°ë‚˜ PASSë¥¼ ì„ íƒí–ˆì„ ë•Œ ëª¨ë‘ failedWordsì— ì¶”ê°€í•©ë‹ˆë‹¤.
                failedWords.push(word); 
                
                feedbackMessage.textContent = userAnswer === null ? 'PASS (ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”)' : 'ì˜¤ë‹µì…ë‹ˆë‹¤. ğŸ˜¥';
                feedbackMessage.classList.remove('text-green-700');
                feedbackMessage.classList.add('text-red-700');
                feedbackArea.classList.remove('bg-green-100');
                feedbackArea.classList.add('bg-red-100');
                questionCard.classList.add('border-red-500');
            }

            // Show correct answer
            const allMeanings = word.korean.join(', ');
            correctAnswerDisplay.innerHTML = 
                currentMode === 'subjective' ? `**ì˜ë‹¨ì–´:** ${word.english} &nbsp;|&nbsp; **ì •ë‹µ(ëœ»):** ${allMeanings}` : 
                                               `**í•œê¸€ ëœ»:** ${word.korean[0]} &nbsp;|&nbsp; **ì •ë‹µ(ì˜ë‹¨ì–´):** ${word.english}`;
            correctAnswerDisplay.classList.add('font-semibold');
            
            if (buttonElement) {
                // Highlight choice buttons
                document.querySelectorAll('#multiple-choice-options button').forEach(btn => {
                    const isCorrectOption = btn.dataset.answer === word.english;
                    
                    btn.classList.remove('bg-white', 'hover:bg-blue-50');
                    if (isCorrectOption) {
                        // Highlight correct answer in green
                        btn.classList.add('bg-green-500', 'text-white', 'border-green-700', 'shadow-xl');
                    } else if (btn === buttonElement) {
                        // Highlight user's incorrect choice in red
                        btn.classList.add('bg-red-500', 'text-white', 'border-red-700', 'shadow-xl');
                    } else {
                        // Dim incorrect options not chosen
                        btn.classList.add('bg-gray-200', 'text-gray-500');
                    }
                    btn.disabled = true;
                });
            }

            feedbackArea.classList.remove('hidden');
        }

        function disableMultipleChoiceButtons() {
            document.querySelectorAll('#multiple-choice-options button').forEach(btn => {
                btn.disabled = true;
            });
        }

        function nextQuestion() {
            currentQuestionIndex++;
            showQuestion();
        }

        function showResult() {
            // UI Transition
            quizArea.classList.add('hidden');
            resultArea.classList.remove('hidden');
            
            finalScoreDisplay.textContent = score;
            
            // Show failed words list
            failedWordsList.innerHTML = '';
            if (failedWords.length > 0) {
                const uniqueFailedWords = Array.from(new Set(failedWords.map(w => w.english)))
                    .map(english => failedWords.find(w => w.english === english)); // Get unique word objects
                
                uniqueFailedWords.forEach(word => {
                    const li = document.createElement('li');
                    li.classList.add('p-2', 'bg-white', 'rounded-md', 'shadow-sm');
                    li.innerHTML = `<span class="font-bold text-red-600">${word.english}</span>: ${word.korean.join(', ')}`;
                    failedWordsList.appendChild(li);
                });
                
                failedWordsSummary.classList.remove('hidden');
                restartFailedBtn.classList.remove('hidden');
            } else {
                failedWordsSummary.classList.add('hidden');
                restartFailedBtn.classList.add('hidden');
                // ì´ ë¸”ë¡ì€ scoreê°€ 20ì ì¼ ë•Œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
                alertBox.show('20ë¬¸ì œ ëª¨ë‘ ì •ë‹µì…ë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰', 'ì™„ë²½í•œ ì ìˆ˜');
            }
        }
        
        function restartFailedQuiz() {
            if (failedWords.length === 0) {
                alertBox.show('í‹€ë¦° ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤!', 'ì •ë³´');
                goToSettings();
                return;
            }
            
            // Use unique words from the last attempt's failed list
            const uniqueFailedWords = Array.from(new Set(failedWords.map(w => w.english)))
                    .map(english => failedWords.find(w => w.english === english));
            
            currentQuizList = uniqueFailedWords;
            failedWords = []; // Reset failed words for the new attempt
            currentQuestionIndex = 0;
            score = 0;
            
            // UI Transition
            resultArea.classList.add('hidden');
            quizArea.classList.remove('hidden');
            
            showQuestion();
        }

        function goToSettings() {
            // UI Transition
            quizArea.classList.add('hidden');
            resultArea.classList.add('hidden');
            settingsArea.classList.remove('hidden');
            // Ensure settings are displayed correctly
            setMode(currentMode); // Re-apply mode visual state
            difficultySelect.value = currentDifficulty; // Re-apply difficulty state
        }
        
        // Initial setup on load (will be triggered after Firebase logic)
        // Ensure initial UI state is correct
        goToSettings(); 
        
    </script>
</body>
</html>
